{
    "doc": {
        "description": "Class chat",
        "tags": {
            "package": "bbn\\Appui"
        }
    },
    "name": "bbn\\Appui\\Chat",
    "namespace": true,
    "traits": [],
    "interfaces": [],
    "fileName": "\/home\/thomas\/domains\/apstapp.thomas.lan\/_appui\/vendor\/bbn\/bbn\/src\/bbn\/Appui\/Chat.php",
    "startLine": 18,
    "endLine": 1176,
    "contentConstructor": {
        "file": "bbn\\Appui\\Chat",
        "returns": null
    },
    "methods": {
        "__construct": {
            "name": "__construct",
            "summary": "Chat constructor.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function(bbn\\Db $db, bbn\\User $user)\n  {\n    if (defined('BBN_DATA_PATH') && $user->checkSession()) {\n      parent::__construct($db);\n      $this->user  = $user;\n      $this->users = new bbn\\User\\Users($this->db);\n    }\n  }",
            "startLine": 38,
            "endLine": 45,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": null,
            "parent": {
                "name": "__construct",
                "summary": "Constructor.",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Db",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function(bbn\\Db $db)\n  {\n    $this->db = $db;\n  }",
                "startLine": 37,
                "endLine": 40,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 1,
                "numberOfRequiredParameters": 1,
                "returns": null,
                "parent": false,
                "arguments": [
                    {
                        "name": "db",
                        "position": 0,
                        "type": "bbn\\Db",
                        "required": true,
                        "has_default": false,
                        "default": "",
                        "default_name": ""
                    }
                ]
            },
            "arguments": [
                {
                    "name": "db",
                    "position": 0,
                    "type": "bbn\\Db",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "The user object"
                },
                {
                    "name": "user",
                    "position": 1,
                    "type": "bbn\\User",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "check": {
            "name": "check",
            "summary": "Checks whether the object has been constructed correctly or not.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    return $this->db && $this->user;\n  }",
            "startLine": 53,
            "endLine": 56,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "bool"
            ],
            "parent": {
                "name": "check",
                "summary": "Checks whether the error property has been set (so an error happened).",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function()\n  {\n    if ($this->error) {\n      return false;\n    }\n\n    return true;\n  }",
                "startLine": 65,
                "endLine": 72,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 0,
                "numberOfRequiredParameters": 0,
                "returns": null,
                "parent": false,
                "arguments": []
            },
            "arguments": []
        },
        "create": {
            "name": "create",
            "summary": "Creates a new chat with the current user and another participant.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function(array $users, $public = 0)\n  {\n    if ($this->check()) {\n      $join   = '';\n      $where  = '';\n      $values = [$this->user->getId(), $public];\n      foreach ($users as $i => $u){\n        $join    .= \"JOIN bbn_chats_users AS u$i ON u$i.id_chat = bbn_chats.id\".PHP_EOL;\n        $where   .= \"AND u$i.id_user = ?\".PHP_EOL;\n        $values[] = $u;\n      }\n\n      $sql = <<<SQL\nSELECT id\nFROM bbn_chats\n  $join\nWHERE creator = ?\nAND public = ?\n$where\nSQL;\n      if (($id_chat = $this->db->getOne($sql, $values))\n          && (count($users) === $this->db->count('bbn_chat_users', ['id_chat' => $id_chat]))\n      ) {\n        return $id_chat;\n      }\n\n      if ($this->db->insert(\n        'bbn_chats', [\n        'creator' => $this->user->getId(),\n        'creation' => date('Y-m-d H:i:s'),\n        'public' => $public ? 1 : 0\n        ]\n      )\n      ) {\n        $id_chat = $this->db->lastId();\n        $this->db->insert(\n          'bbn_chats_users', [\n          'id_chat' => $id_chat,\n          'id_user' => $this->user->getId(),\n          'entrance' => X::microtime(),\n          'admin' => 1\n          ]\n        );\n        foreach ($users as $user) {\n          $this->db->insertIgnore(\n            'bbn_chats_users', [\n            'id_chat' => $id_chat,\n            'id_user' => $user,\n            'entrance' => X::microtime(),\n            'admin' => 0\n            ]\n          );\n        }\n\n        $this->_set_state_hash($id_chat);\n        return $id_chat;\n      }\n    }\n\n    return null;\n  }",
            "startLine": 66,
            "endLine": 126,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "users",
                    "position": 0,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "public",
                    "position": 1,
                    "type": "int",
                    "required": false,
                    "has_default": true,
                    "default": 0,
                    "default_name": ""
                }
            ]
        },
        "createGroup": {
            "name": "createGroup",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($title, array $users, array $admins = [])\n  {\n    if (($time = X::microtime())\n        && !empty($users)\n        && ($id_user = $this->user->getId())\n        && ($username = $this->user->getName())\n        && $this->db->insert(\n          'bbn_chats', [\n          'title' => $title,\n          'creator' => $id_user,\n          'creation' => date('Y-m-d H:i:s', $time)\n          ]\n        )\n        && ($id = $this->db->lastId())\n        && $this->db->insert(\n          'bbn_chats_users', [\n          'id_chat' => $id,\n          'id_user' => $id_user,\n          'entrance' => $time,\n          'admin' => 1\n          ]\n        )\n    ) {\n      $users        = array_filter(\n        $users, function ($u) use ($id_user) {\n          return $u !== $id_user;\n        }\n      );\n      $admins       = array_filter(\n        $admins, function ($u) use ($id_user) {\n          return $u !== $id_user;\n        }\n      );\n      $users_added  = 0;\n      $admins_added = 0;\n      foreach ($users as $user) {\n        if (bbn\\Str::isUid($user)) {\n          $users_added += $this->db->insert(\n            'bbn_chats_users', [\n            'id_chat' => $id,\n            'id_user' => $user,\n            'entrance' => $time,\n            'admin' => 0\n            ]\n          );\n        }\n      }\n\n      $this->_add_bot_message(\n        $id, [\n        $id_user => dgettext(X::tDom(), 'You created this group'),\n        \"$username \" . dgettext(X::tDom(), 'created this group')\n        ]\n      );\n      foreach ($users as $user) {\n        if (bbn\\Str::isUid($user)) {\n          $name = $this->user->getName($user);\n          $this->_add_bot_message(\n            $id, [\n            $id_user => dgettext(X::tDom(), 'You added') . \" $name \" .  dgettext(X::tDom(), 'to the group'),\n            $user => $username . ' ' . dgettext(X::tDom(), 'added you to the group'),\n            \"$username \" . dgettext(X::tDom(), 'added') . \" $name \" . dgettext(X::tDom(), 'to the group')\n            ]\n          );\n          if (\\in_array($user, $admins, true)) {\n            $admins_added += (int)$this->addAdmin($id, $user);\n          }\n        }\n      }\n\n      $this->_set_state_hash($id);\n      return (count($users) === $users_added) && (count($admins) === $admins_added);\n    }\n\n    return null;\n  }",
            "startLine": 129,
            "endLine": 204,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 3,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "title",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "users",
                    "position": 1,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "admins",
                    "position": 2,
                    "type": "array",
                    "required": false,
                    "has_default": true,
                    "default": [],
                    "default_name": ""
                }
            ]
        },
        "destroy": {
            "name": "destroy",
            "summary": "Destroys the given chat",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat)\n  {\n    return $this->check()\n      && bbn\\Str::isUid($id_chat)\n      && $this->isCreator($id_chat)\n      && $this->db->update('bbn_chats', ['blocked' => 1], ['id' => $id_chat])\n      && $this->db->update('bbn_chats_users', ['active' => 0], ['id_chat' => $id_chat])\n      && $this->_set_state_hash($id_chat);\n  }",
            "startLine": 212,
            "endLine": 220,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "chat"
                }
            ]
        },
        "talk": {
            "name": "talk",
            "summary": "Sends a new message from the current user in the given chat.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $message)\n  {\n    if ($this->check() && ($chat = $this->info($id_chat)) && !$chat['blocked']) {\n      $users = $this->getParticipants($id_chat);\n      if (\\in_array($this->user->getId(), $users, true)) {\n        $time = X::microtime();\n        $st   = bbn\\Util\\Enc::crypt(json_encode(['time' => $time, 'user' => $this->user->getId(), 'message' => $message]));\n        $day  = date('Y-m-d');\n        foreach ($users as $user) {\n          $dir = bbn\\Mvc::getUserDataPath($user, 'appui-chat').$id_chat.'\/'.$day;\n          if (bbn\\File\\Dir::createPath($dir)) {\n            file_put_contents($dir.'\/'.$time.'.msg', $st);\n          }\n        }\n\n        $this->setLastActivity($id_chat, $this->user->getId());\n        return $this->db->update('bbn_chats', ['last_message' => $time], ['id' => $id_chat]);\n      }\n    }\n\n    return null;\n  }",
            "startLine": 230,
            "endLine": 251,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "int",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "message",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "info": {
            "name": "info",
            "summary": "Gets information about the given chat.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat)\n  {\n    if ($this->check() && bbn\\Str::isUid($id_chat)) {\n      return $this->db->rselect('bbn_chats', [], ['id' => $id_chat]) ?: null;\n    }\n\n    return null;\n  }",
            "startLine": 260,
            "endLine": 267,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "getChatsHash": {
            "name": "getChatsHash",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($entrance = NULL)\n  {\n    $res = '';\n    foreach ($this->getChats($entrance) as $c) {\n      if ($h = $this->_get_state_hash($c)) {\n        $res .= $h;\n      }\n    }\n\n    return $res ? \\md5($res) : null;\n  }",
            "startLine": 270,
            "endLine": 280,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 0,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "entrance",
                    "position": 0,
                    "type": "float",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "setTitle": {
            "name": "setTitle",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $title = NULL)\n  {\n    if (\\bbn\\Str::isUid($id_chat)\n        && $this->isAdmin($id_chat)\n        && $this->db->update('bbn_chats', ['title' => $title], ['id' => $id_chat])\n    ) {\n      $this->_set_state_hash($id_chat);\n      return $this->_add_bot_message(\n        $id_chat, [\n        $this->user->getId() => dgettext(X::tDom(), \"You have changed the chat title\"),\n        $this->user->getName() . ' ' . dgettext(X::tDom(), 'has changed the chat title')\n        ]\n      );\n    }\n  }",
            "startLine": 283,
            "endLine": 297,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": null,
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "title",
                    "position": 1,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "addUser": {
            "name": "addUser",
            "summary": "Adds the given user to the given chat (if the current user is admin of this chat).",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user)\n  {\n    if ($this->isAdmin($id_chat)\n        && ($name1 = $this->user->getName())\n        && ($name2 = $this->user->getName($id_user))\n        && $this->db->insertUpdate(\n          'bbn_chats_users', [\n          'id_chat' => $id_chat,\n          'id_user' => $id_user,\n          'entrance' => X::microtime(),\n          'admin' => 0,\n          'active' => 1\n          ]\n        )\n    ) {\n      $this->_set_state_hash($id_chat);\n      return $this->_add_bot_message(\n        $id_chat, [\n        $this->user->getId() => dgettext(X::tDom(), 'You added') . \" $name2\",\n        $id_user => \"$name1 \" . dgettext(X::tDom(), 'added you'),\n        $name1 . ' ' . dgettext(X::tDom(), 'added') . ' ' . $name2\n        ]\n      );\n    }\n\n    return false;\n  }",
            "startLine": 307,
            "endLine": 333,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user"
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "removeUser": {
            "name": "removeUser",
            "summary": "Removes the given user to the given chat (if the current user is admin of this chat).",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user)\n  {\n    if ($this->isAdmin($id_chat)\n        && bbn\\Str::isUid($id_user)\n        && ($name1 = $this->user->getName())\n        && ($name2 = $this->user->getName($id_user))\n        && $this->db->update(\n          'bbn_chats_users', ['active' => 0], [\n          'id_chat' => $id_chat,\n          'id_user' => $id_user\n          ]\n        )\n    ) {\n      $this->_set_state_hash($id_chat);\n      return $this->_add_bot_message(\n        $id_chat, [\n        $this->user->getId() => dgettext(X::tDom(), 'You remove') . \" $name2\",\n        $name1 . ' ' . dgettext(X::tDom(), 'removed') . ' ' . $name2\n        ]\n      );\n    }\n\n    return false;\n  }",
            "startLine": 343,
            "endLine": 366,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user"
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "addAdmin": {
            "name": "addAdmin",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user)\n  {\n    if ($this->check()\n        && bbn\\Str::isUid($id_chat)\n        && bbn\\Str::isUid($id_user)\n        && $this->isCreator($id_chat)\n        && ($name = $this->user->getName())\n        && ($name2 = $this->user->getName($id_user))\n    ) {\n      return $this->_set_admin(\n        $id_chat, $id_user, true, [\n        $this->user->getId() => dgettext(X::tDom(), 'You set') . \" $name2 \" . dgettext(X::tDom(), 'as admin'),\n        $id_user => \"$name \" . dgettext(X::tDom(), 'set you as admin'),\n        \"$name \" . dgettext(X::tDom(), 'set') . \" $name2 \" . dgettext(X::tDom(), 'as admin')\n        ]\n      );\n    }\n\n    return null;\n  }",
            "startLine": 369,
            "endLine": 388,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "removeAdmin": {
            "name": "removeAdmin",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user)\n  {\n    if ($this->check()\n        && bbn\\Str::isUid($id_chat)\n        && bbn\\Str::isUid($id_user)\n        && $this->isCreator($id_chat)\n        && ($name = $this->user->getName())\n        && ($name2 = $this->user->getName($id_user))\n    ) {\n      return $this->_set_admin(\n        $id_chat, $id_user, false, [\n        $this->user->getId() => dgettext(X::tDom(), 'You removed') . \" $name2 \" . dgettext(X::tDom(), 'as admin'),\n        $id_user => \"$name \" . dgettext(X::tDom(), 'removed you as admin'),\n        \"$name \" . dgettext(X::tDom(), 'removed') . \" $name2 \" . dgettext(X::tDom(), 'as admin')\n        ]\n      );\n    }\n\n    return null;\n  }",
            "startLine": 391,
            "endLine": 410,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "getParticipants": {
            "name": "getParticipants",
            "summary": "Returns the participants of the given chat as an array of id_user.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $with_current = true, $last_activity = false)\n  {\n    if ($this->check()) {\n      $ucfg = $this->user->getClassCfg();\n      $cfg  = [\n        'table' => 'bbn_chats_users',\n        'fields' => ['bbn_chats_users.id_user'],\n        'join' => [[\n          'table' => $ucfg['table'],\n          'on' => [\n            'conditions' => [[\n              'field' => 'bbn_chats_users.id_user',\n              'exp' => $ucfg['table'].'.'.$ucfg['arch']['users']['id']\n            ], [\n              'field' => $ucfg['table'].'.'.$ucfg['arch']['users']['active'],\n              'value' => 1\n            ]]\n          ]\n        ]],\n        'where' => [\n          'conditions' => [[\n            'field' => 'id_chat',\n            'value' => $id_chat\n          ], [\n            'field' => 'active',\n            'value' => 1\n          ]]\n        ]\n      ];\n      if (!$with_current) {\n        $cfg['where']['conditions'][] = [\n          'field' => 'bbn_chats_users.id_user',\n          'operator' => '!=',\n          'value' => $this->user->getId()\n        ];\n      }\n\n      if ($last_activity) {\n        $cfg['fields'] = [\n          'id' => 'bbn_chats_users.id_user',\n          'lastActivity' => 'bbn_chats_users.last_activity',\n         \/\/ 'lastUserActivity' => 'UNIX_TIMESTAMP(MAX('.$ucfg['tables']['sessions].'.'.$ucfg['arch']['sessions']['last_activity'].'))'\n        ];\n        \/* $cfg['join'][] = [\n          'table' => $ucfg['tables']['sessions],\n          'type' => 'left',\n          'on' => [\n            'conditions' => [[\n              'field' => $ucfg['tables']['sessions].'.'.$ucfg['arch']['sessions']['id_user'],\n              'exp' => 'bbn_chats_users.id_user'\n            ]]\n          ]\n        ];\n        $cfg['group_by'] = [$ucfg['tables']['sessions].'.'.$ucfg['arch']['sessions']['id_user']]; *\/\n        return $this->db->rselectAll($cfg);\n      }\n\n      return $this->db->getFieldValues($cfg);\n    }\n\n    return null;\n  }",
            "startLine": 420,
            "endLine": 481,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 3,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "current"
                },
                {
                    "name": "with_current",
                    "position": 1,
                    "type": "bool",
                    "required": false,
                    "has_default": true,
                    "default": true,
                    "default_name": ""
                },
                {
                    "name": "last_activity",
                    "position": 2,
                    "type": "bool",
                    "required": false,
                    "has_default": true,
                    "default": false,
                    "default_name": ""
                }
            ]
        },
        "getAdmins": {
            "name": "getAdmins",
            "summary": "Returns the admins of the given chat as an array of id_user.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat)\n  {\n    if ($this->check()\n        && bbn\\Str::isUid($id_chat)\n    ) {\n      return $this->db->getFieldValues(\n        'bbn_chats_users', 'id_user', [\n          'id_chat' => $id_chat,\n          'active' => 1,\n          'admin' => 1\n        ]\n      );\n    }\n\n    return null;\n  }",
            "startLine": 490,
            "endLine": 505,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "isParticipant": {
            "name": "isParticipant",
            "summary": "Checks whether the given user is participant of the given chat.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user = NULL)\n  {\n    if ($this->check()\n        && bbn\\Str::isUid($id_chat)\n        && (bbn\\Str::isUid($id_user) || \\is_null($id_user))\n    ) {\n      return (bool)$this->db->count(\n        'bbn_chats_users', [\n        'id_chat' => $id_chat,\n        'id_user' => $id_user ?: $this->user->getId()\n        ]\n      );\n    }\n\n    return null;\n  }",
            "startLine": 515,
            "endLine": 530,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user"
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "isAdmin": {
            "name": "isAdmin",
            "summary": "Checks whether the current user is an admin of the given chat or not.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user = NULL)\n  {\n    if ($this->check()\n        && bbn\\Str::isUid($id_chat)\n        && ($chat = $this->info($id_chat))\n        && !$chat['blocked']\n        && (bbn\\Str::isUid($id_user) || \\is_null($id_user))\n    ) {\n      return (bool)$this->db->count(\n        'bbn_chats_users', [\n        'id_chat' => $id_chat,\n        'id_user' => $id_user ?: $this->user->getId(),\n        'admin' => 1\n        ]\n      );\n    }\n\n    return null;\n  }",
            "startLine": 540,
            "endLine": 558,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user"
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "isCreator": {
            "name": "isCreator",
            "summary": "Checks whether the current user is the creator of the given chat or not.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user = NULL)\n  {\n    if ($this->check()\n        && bbn\\Str::isUid($id_chat)\n        && ($chat = $this->info($id_chat))\n        && !$chat['blocked']\n        && (bbn\\Str::isUid($id_user) || \\is_null($id_user))\n    ) {\n      return $chat['creator'] === $id_user ?: $this->user->getId();\n    }\n\n    return null;\n  }",
            "startLine": 568,
            "endLine": 580,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user"
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "getChats": {
            "name": "getChats",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($entrance = NULL)\n  {\n    if ($this->check()) {\n      $where = [\n        'conditions' => [[\n          'field' => 'bbn_chats_users.id_user',\n          'value' => $this->user->getId()\n        ], [\n          'field' => 'bbn_chats_users.active',\n          'value' => 1\n        ]]\n      ];\n      if (\\is_float($entrance)) {\n        $where['conditions'][] = [\n          'field' => 'bbn_chats_users.entrance',\n          'operator' => '<=',\n          'value' => $entrance\n        ];\n      }\n\n      return $this->db->getFieldValues(\n        [\n        'table' => 'bbn_chats_users',\n        'fields' => ['id_chat'],\n        'join' => [[\n          'table' => 'bbn_chats',\n          'on' => [\n            'conditions' => [[\n              'field' => 'bbn_chats_users.id_chat',\n              'exp' => 'bbn_chats.id'\n            ]]\n          ]\n        ]],\n        'where' => $where,\n        'order' => [[\n          'field' => 'bbn_chats.last_message',\n          'dir' => 'DESC'\n        ]]\n        ]\n      );\n    }\n  }",
            "startLine": 583,
            "endLine": 624,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 0,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "entrance",
                    "position": 0,
                    "type": "float",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "getChatByUsers": {
            "name": "getChatByUsers",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function(array $users)\n  {\n    if ($this->check() && count($users)) {\n      $cfg     = [\n        'tables' => ['bbn_chats'],\n        'fields' => ['bbn_chats.id'],\n        'join' => [],\n        'where' => ['blocked' => 0]\n      ];\n      $users[] = $this->user->getId();\n      $users   = array_unique($users);\n      foreach ($users as $i => $u) {\n        $cfg['join'][]                         = [\n          'table' => 'bbn_chats_users',\n          'alias' => 'u'.($i + 1),\n          'on' => [\n            'conditions' => [[\n              'field' => 'bbn_chats.id',\n              'exp' => 'u'.($i + 1).'.id_chat'\n            ]]\n          ]\n        ];\n        $cfg['where']['u'.($i + 1).'.id_user'] = $u;\n      }\n\n      $id_chat = false;\n      $ids     = $this->db->getColumnValues($cfg);\n      if (count($ids)) {\n        foreach ($ids as $id) {\n          if (count($this->getParticipants($id)) === count($users)) {\n            $id_chat = $id;\n            break;\n          }\n        }\n      }\n\n      if (!$id_chat) {\n        $id_chat = $this->create($users);\n      }\n\n      return $id_chat ?: null;\n    }\n\n    return null;\n  }",
            "startLine": 627,
            "endLine": 671,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "users",
                    "position": 0,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "hasOldMessages": {
            "name": "hasOldMessages",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $moment)\n  {\n    if ($this->check()) {\n      $cdir = bbn\\Mvc::getUserDataPath($this->user->getId(), 'appui-chat').$id_chat.'\/';\n      if ($this->isParticipant($id_chat) && is_dir($cdir)) {\n        $dir   = $cdir . date('Y-m-d', $moment);\n        $files = \\bbn\\File\\Dir::getFiles($dir);\n        foreach ($files as $file){\n          $time = round((float)basename($file, '.msg'), 4);\n          if (X::compareFloats($time, $moment, '<') && ($st = file_get_contents($file))) {\n            return true;\n          }\n        }\n\n        $dirs = \\bbn\\File\\Dir::getDirs($cdir);\n        foreach ($dirs as $d){\n          if ((basename($d) < date('Y-m-d', $moment)) && !empty(\\bbn\\File\\Dir::getFiles($d))) {\n            return true;\n          }\n        }\n      }\n    }\n\n    return false;\n  }",
            "startLine": 674,
            "endLine": 698,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "moment",
                    "position": 1,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "getPrevMessages": {
            "name": "getPrevMessages",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $moment = NULL, $num = 50, $id_user = NULL)\n  {\n    return $this->_get_messages($id_chat, $moment ?: X::microtime(), '<', $num, $id_user);\n  }",
            "startLine": 701,
            "endLine": 704,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 4,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "moment",
                    "position": 1,
                    "type": "float",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                },
                {
                    "name": "num",
                    "position": 2,
                    "type": "int",
                    "required": false,
                    "has_default": true,
                    "default": 50,
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 3,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "getNextMessages": {
            "name": "getNextMessages",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $moment = NULL, $num = 0, $id_user = NULL)\n  {\n    return $this->_get_messages($id_chat, $moment ?: X::microtime(), '>', $num, $id_user);\n  }",
            "startLine": 707,
            "endLine": 710,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 4,
            "numberOfRequiredParameters": 1,
            "returns": null,
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "moment",
                    "position": 1,
                    "type": "float",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                },
                {
                    "name": "num",
                    "position": 2,
                    "type": "int",
                    "required": false,
                    "has_default": true,
                    "default": 0,
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 3,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "getFromtoMessages": {
            "name": "getFromtoMessages",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $from, $to, $num = 0)\n  {\n\n  }",
            "startLine": 713,
            "endLine": 716,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 4,
            "numberOfRequiredParameters": 3,
            "returns": null,
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "from",
                    "position": 1,
                    "type": "float",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "to",
                    "position": 2,
                    "type": "float",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "num",
                    "position": 3,
                    "type": "int",
                    "required": false,
                    "has_default": true,
                    "default": 0,
                    "default_name": ""
                }
            ]
        },
        "block": {
            "name": "block",
            "summary": "Close a chat by setting blocked to 1.",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat)\n  {\n    if ($this->isAdmin($id_chat) && $this->db->update('bbn_chats', ['blocked' => 1], ['id' => $id_chat])) {\n      return $this->_set_state_hash($id_chat);\n    }\n\n    return false;\n  }",
            "startLine": 725,
            "endLine": 732,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "leave": {
            "name": "leave",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user = NULL)\n  {\n    if ($this->check()\n        && bbn\\Str::isUid($id_chat)\n        && $this->isParticipant($id_chat)\n        && $this->_add_bot_message($id_chat, $this->user->getName($id_user ?: $this->user->getId()) . ' ' . dgettext(X::tDom(), 'has left the chat'))\n        && $this->db->update(\n          'bbn_chats_users', ['active' => 0], [\n          'id_chat' => $id_chat,\n          'id_user' => $id_user ?: $this->user->getId()\n          ]\n        )\n    ) {\n      $ok = true;\n      if (($parts = $this->getParticipants($id_chat))\n          && (count($parts) === 1)\n      ) {\n        $ok = !!$this->leave($id_chat, $parts[0]);\n      }\n\n      $this->_set_state_hash($id_chat);\n      return $ok;\n    }\n\n    return null;\n  }",
            "startLine": 735,
            "endLine": 760,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "getLastActivity": {
            "name": "getLastActivity",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user)\n  {\n    if (bbn\\Str::isUid($id_chat)\n        && bbn\\Str::isUid($id_user)\n        && ($last = $this->db->selectOne(\n          'bbn_chats_users', 'last_activity', [\n          'id_chat' => $id_chat,\n          'id_user' => $id_user\n          ]\n        ))\n    ) {\n      return round((float)$last, 4);\n    }\n\n    return round((float)0, 4);\n  }",
            "startLine": 763,
            "endLine": 778,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "float"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "setLastActivity": {
            "name": "setLastActivity",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user)\n  {\n    if (bbn\\Str::isUid($id_chat)\n        && bbn\\Str::isUid($id_user)\n        && $this->isParticipant($id_chat, $id_user)\n        && $this->db->update(\n          'bbn_chats_users', ['last_activity' => X::microtime()], [\n          'id_chat' => $id_chat,\n          'id_user' => $id_user\n          ]\n        )\n    ) {\n      return $this->_set_state_hash($id_chat);\n    }\n\n    return null;\n  }",
            "startLine": 781,
            "endLine": 797,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "getMaxLastActivity": {
            "name": "getMaxLastActivity",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user = NULL)\n  {\n    if ($this->check()\n        && (bbn\\Str::isUid($id_user)\n        || \\is_null($id_user))\n    ) {\n      return $this->db->selectOne(\n        'bbn_chats_users', 'MAX(last_activity)', [\n        'id_user' => $id_user ?: $this->user->getId(),\n        'active' => 1\n        ]\n      );\n    }\n  }",
            "startLine": 800,
            "endLine": 813,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "setLastNotification": {
            "name": "setLastNotification",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $id_user, $moment = NULL)\n  {\n    if (bbn\\Str::isUid($id_chat) && bbn\\Str::isUid($id_user)) {\n      if (\\is_null($moment)) {\n        $moment = bbn\\X::microtime();\n      }\n\n      return (bool)$this->db->update(\n        'bbn_chats_users', ['last_notification' => $moment], [\n        'id_chat' => $id_chat,\n        'id_user' => $id_user\n        ]\n      );\n    }\n\n    return false;\n  }",
            "startLine": 816,
            "endLine": 832,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 3,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "moment",
                    "position": 2,
                    "type": "float",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "setOnline": {
            "name": "setOnline",
            "summary": "Sets the current user online",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    return $this->_set_user_status(true);\n  }",
            "startLine": 839,
            "endLine": 842,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": []
        },
        "setOffline": {
            "name": "setOffline",
            "summary": "Sets the current user offline",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    return $this->_set_user_status(false);\n  }",
            "startLine": 849,
            "endLine": 852,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": []
        },
        "getOnlineUsers": {
            "name": "getOnlineUsers",
            "summary": "Gets the list of online users",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    if($this->check()) {\n      if ($ids = $this->users->onlineList()) {\n        $t = $this;\n        return array_values(\n          array_filter(\n            $ids, function ($id) use ($t) {\n              return $t->getUserStatus($id);\n            }\n          )\n        );\n      }\n    }\n\n    return [];\n  }",
            "startLine": 859,
            "endLine": 875,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "array"
            ],
            "parent": false,
            "arguments": []
        },
        "getUserStatus": {
            "name": "getUserStatus",
            "summary": "Gets the status of the current|given user",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id = NULL)\n  {\n    $ucfg = $this->user->getClassCfg();\n    $cfg  = json_decode($this->db->selectOne($ucfg['table'], $ucfg['arch']['users']['cfg'], [$ucfg['arch']['users']['id'] => $id ?: $this->user->getId()]), true);\n    return !isset($cfg['appui-chat']['online']) || !empty($cfg['appui-chat']['online']);\n  }",
            "startLine": 883,
            "endLine": 888,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 0,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id",
                    "position": 0,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "mute": {
            "name": "mute",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n\n  }",
            "startLine": 891,
            "endLine": 894,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": false,
            "arguments": []
        },
        "unmute": {
            "name": "unmute",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n\n  }",
            "startLine": 897,
            "endLine": 900,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": false,
            "arguments": []
        },
        "getMessages": {
            "name": "getMessages",
            "summary": "Deprecated??",
            "description": "Returns messages from the given chat sent after $last.",
            "description_parts": [
                {
                    "type": "text",
                    "content": "<p>Returns messages from the given chat sent after $last.<\/p>"
                }
            ],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $last = NULL, $day = NULL)\n  {\n    $res = ['success' => false, 'last' => null, 'messages' => []];\n    if ($this->check()) {\n      $dir = bbn\\Mvc::getUserDataPath($this->user->getId(), 'appui-chat').$id_chat.'\/'.($day ?: date('Y-m-d'));\n      if ($this->isParticipant($id_chat) && is_dir($dir)) {\n        $res['success'] = true;\n        $files          = bbn\\File\\Dir::getFiles($dir);\n        foreach ($files as $file){\n          $time = (float)basename($file, '.msg');\n          if ((!$last || X::compareFloats($time, $last, '>')) && ($st = file_get_contents($file))) {\n            $res['messages'][] = json_decode(bbn\\Util\\Enc::decrypt($st), true);\n          }\n        }\n\n        if (isset($time)) {\n          $res['last'] = $time;\n        }\n      }\n    }\n\n    return $res;\n  }",
            "startLine": 912,
            "endLine": 934,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 3,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "last",
                    "position": 1,
                    "type": null,
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                },
                {
                    "name": "day",
                    "position": 2,
                    "type": null,
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "getOldMessages": {
            "name": "getOldMessages",
            "summary": "Deprecated??",
            "description": "Returns messages from the given chat for a specific day.",
            "description_parts": [
                {
                    "type": "text",
                    "content": "<p>Returns messages from the given chat for a specific day.<\/p>"
                }
            ],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_chat, $day)\n  {\n    return $this->getMessages($id_chat, null, $day);\n  }",
            "startLine": 945,
            "endLine": 948,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": null,
            "parent": false,
            "arguments": [
                {
                    "name": "id_chat",
                    "position": 0,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "day",
                    "position": 1,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "getActiveChats": {
            "name": "getActiveChats",
            "summary": "Deprecated??",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Appui\\Chat",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    if ($chats = $this->getChats()) {\n      $t =& $this;\n      $d = new \\DateTime();\n      $d->sub(new \\DateInterval('PT20M'));\n      if ($chats = array_filter(\n        $chats, function ($c) use ($d, $t) {\n          return ($m = $t->getMessages($c, $d->getTimestamp())) && !empty($m['messages']);\n        }\n      )\n      ) {\n        return array_map(\n          function ($c) use ($d, $t) {\n            return [\n              'id' => $c,\n              'messages' => ($m = $t->getMessages($c)) ? $m['messages'] : [],\n              'partecipants' => $t->getParticipants($c),\n              'has_old' => $t->hasOldMessages($c, $d->getTimestamp() - 1)\n            ];\n          }, $chats\n        );\n      }\n    }\n\n    return [];\n  }",
            "startLine": 954,
            "endLine": 980,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": false,
            "arguments": []
        },
        "test": {
            "name": "test",
            "summary": "Checks whether the error property has been set (so an error happened).",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Models\\Cls\\Basic",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    if ($this->error) {\n      return false;\n    }\n\n    return true;\n  }",
            "startLine": 51,
            "endLine": 58,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": {
                "name": "test",
                "summary": "Checks whether the error property has been set (so an error happened).",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function()\n  {\n    if ($this->error) {\n      return false;\n    }\n\n    return true;\n  }",
                "startLine": 51,
                "endLine": 58,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 0,
                "numberOfRequiredParameters": 0,
                "returns": null,
                "parent": false,
                "arguments": []
            },
            "arguments": []
        },
        "getError": {
            "name": "getError",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Models\\Cls\\Basic",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    return $this->error;\n  }",
            "startLine": 86,
            "endLine": 89,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": {
                "name": "getError",
                "summary": "",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function()\n  {\n    return $this->error;\n  }",
                "startLine": 86,
                "endLine": 89,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 0,
                "numberOfRequiredParameters": 0,
                "returns": null,
                "parent": false,
                "arguments": []
            },
            "arguments": []
        },
        "getErrors": {
            "name": "getErrors",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Models\\Cls\\Basic",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n\n  }",
            "startLine": 92,
            "endLine": 95,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": {
                "name": "getErrors",
                "summary": "",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function()\n  {\n\n  }",
                "startLine": 92,
                "endLine": 95,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 0,
                "numberOfRequiredParameters": 0,
                "returns": null,
                "parent": false,
                "arguments": []
            },
            "arguments": []
        },
        "log": {
            "name": "log",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Models\\Cls\\Basic",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    if ($this->isDebug()) {\n        $ar = \\func_get_args();\n        $cn = bbn\\Str::encodeFilename(str_replace('\\\\', '_', \\get_class($this)));\n      foreach ($ar as $a){\n            X::log($a, $cn);\n      }\n    }\n  }",
            "startLine": 98,
            "endLine": 107,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": {
                "name": "log",
                "summary": "",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function()\n  {\n    if ($this->isDebug()) {\n        $ar = \\func_get_args();\n        $cn = bbn\\Str::encodeFilename(str_replace('\\\\', '_', \\get_class($this)));\n      foreach ($ar as $a){\n            X::log($a, $cn);\n      }\n    }\n  }",
                "startLine": 98,
                "endLine": 107,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 0,
                "numberOfRequiredParameters": 0,
                "returns": null,
                "parent": false,
                "arguments": []
            },
            "arguments": []
        },
        "__call": {
            "name": "__call",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Models\\Cls\\Basic",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($name, $arguments)\n  {\n    $class = \\get_class($this);\n    throw new \\Exception(\n      sprintf(\n        dgettext(X::tDom(), \"Wrong method used for the class %s: %s with the following arguments:\"),\n        $class,\n        $name,\n        implode(', ', $arguments)\n      )\n    );\n  }",
            "startLine": 115,
            "endLine": 126,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": null,
            "parent": {
                "name": "__call",
                "summary": "",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function($name, $arguments)\n  {\n    $class = \\get_class($this);\n    throw new \\Exception(\n      sprintf(\n        dgettext(X::tDom(), \"Wrong method used for the class %s: %s with the following arguments:\"),\n        $class,\n        $name,\n        implode(', ', $arguments)\n      )\n    );\n  }",
                "startLine": 115,
                "endLine": 126,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 2,
                "numberOfRequiredParameters": 2,
                "returns": null,
                "parent": false,
                "arguments": [
                    {
                        "name": "name",
                        "position": 0,
                        "type": null,
                        "required": true,
                        "has_default": false,
                        "default": "",
                        "default_name": ""
                    },
                    {
                        "name": "arguments",
                        "position": 1,
                        "type": null,
                        "required": true,
                        "has_default": false,
                        "default": "",
                        "default_name": ""
                    }
                ]
            },
            "arguments": [
                {
                    "name": "name",
                    "position": 0,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "arguments",
                    "position": 1,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "isDebug": {
            "name": "isDebug",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Models\\Cls\\Basic",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    return $this->debug || (defined(\"BBN_IS_DEV\") && BBN_IS_DEV);\n  }",
            "startLine": 132,
            "endLine": 135,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": {
                "name": "isDebug",
                "summary": "",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function()\n  {\n    return $this->debug || (defined(\"BBN_IS_DEV\") && BBN_IS_DEV);\n  }",
                "startLine": 132,
                "endLine": 135,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 0,
                "numberOfRequiredParameters": 0,
                "returns": null,
                "parent": false,
                "arguments": []
            },
            "arguments": []
        },
        "setDebug": {
            "name": "setDebug",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\Models\\Cls\\Basic",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($debug)\n  {\n    $this->debug = $debug;\n  }",
            "startLine": 142,
            "endLine": 145,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": null,
            "parent": {
                "name": "setDebug",
                "summary": "",
                "description": "",
                "description_parts": [],
                "file": "bbn\\Models\\Cls\\Basic",
                "static": false,
                "visibility": "public",
                "final": false,
                "code": "function($debug)\n  {\n    $this->debug = $debug;\n  }",
                "startLine": 142,
                "endLine": 145,
                "isDeprecated": false,
                "isGenerator": false,
                "isInternal": false,
                "isUserDefined": true,
                "isVariadic": false,
                "returnsReference": false,
                "numberOfParameters": 1,
                "numberOfRequiredParameters": 1,
                "returns": null,
                "parent": false,
                "arguments": [
                    {
                        "name": "debug",
                        "position": 0,
                        "type": "bool",
                        "required": true,
                        "has_default": false,
                        "default": "",
                        "default_name": ""
                    }
                ]
            },
            "arguments": [
                {
                    "name": "debug",
                    "position": 0,
                    "type": "bool",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        }
    },
    "properties": null,
    "staticProperties": [],
    "constants": null,
    "numMethods": 46,
    "numProperties": 0,
    "numConstants": 0,
    "numStaticProperties": 0,
    "interfaceNames": [],
    "isInterface": false,
    "traitNames": [],
    "traitAliases": [],
    "isTrait": false,
    "isAbstract": false,
    "isFinal": false,
    "modifiers": 0,
    "parentClass": "bbn\\Models\\Cls\\Db",
    "isSubclassOf": false,
    "defaultProperties": {
        "user": null,
        "users": null,
        "db": null,
        "errors": [],
        "error": false,
        "debug": false,
        "log": []
    },
    "isIterable": false,
    "extensionName": false,
    "namespaceName": "bbn\\Appui",
    "shortName": "Chat",
    "summary": "Class chat"
}